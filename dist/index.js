"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }var _react = require('react'); var _react2 = _interopRequireDefault(_react);var ge=o=>{let e=null;switch(o){case 0:e="Jan";break;case 1:e="Feb";break;case 2:e="Mar";break;case 3:e="Apr";break;case 4:e="May";break;case 5:e="Jun";break;case 6:e="Jul";break;case 7:e="Aug";break;case 8:e="Sep";break;case 9:e="Oct";break;case 10:e="Nov";break;case 11:e="Dec";break;default:e="Jan"}return e},J=ge;var fe=o=>{let e=null;switch(o){case 0:e="Mon";break;case 1:e="Tue";break;case 2:e="Wed";break;case 3:e="Thu";break;case 4:e="Fri";break;case 5:e="Sat";break;case 6:e="Sun";break;default:e="Mon"}return e},X=fe;var we=({windowTime:o,tick:e,contentWidth:r,blockWidth:i})=>{let{dayBlocks:t,hourBlocks:s}=_react.useMemo.call(void 0, ()=>{let c=o[0],d=[],h=[];if(e===null||r===null)return{dayBlocks:[],hourBlocks:[]};let l=r,a=1;for(;;){let u=new Date(c*1e3),f=new Date(u.getFullYear(),u.getMonth(),u.getDate(),23,59,59),p=(f.getTime()-u.getTime())/1e3/e;if(l-=p,Math.round(l)<0){let m=Math.round((p+l)/i);for(let w=0;w<m;w++)h.push(_react2.default.createElement("div",{className:"hour-block",key:`${u.getDate()}_hour_${w}`},w<10?`0${w}:00`:`${w}:00`));d.push(_react2.default.createElement("div",{className:"day-block",key:`${u.getDate()} ${u.getMonth()}`,style:{gridColumn:`${a} / ${a+m}`}},X(u.getDay())," ",u.getDate()," ",J(u.getMonth()))),a+=m;break}let g=Math.round(p/i);for(let m=24-g;m<24;m++)h.push(_react2.default.createElement("div",{className:"hour-block",key:`${u.getDate()}_hour_${m}`},m<10?`0${m}:00`:`${m}:00`));if(d.push(_react2.default.createElement("div",{className:"day-block",key:`${u.getDate()} ${u.getMonth()}`,style:{gridColumn:`${a} / ${a+g}`}},X(u.getDay())," ",u.getDate()," ",J(u.getMonth()))),a+=g,Math.round(l)===0)break;c=(f.getTime()+1e3)/1e3}return{dayBlocks:d,hourBlocks:h}},[e,o,r]);return{dayBlocks:t,hourBlocks:s}},q=we;var xe=({windowTime:o,contentWidth:e})=>{let r=_react.useMemo.call(void 0, ()=>(o[1]-o[0])/3600,[o]),i=e?e/r:0;return{numberOfHourBlocks:r,blockWidth:i}},I=xe;var Te=({windowTime:o,tick:e,contentWidth:r,scrollWidth:i,additionalClassNames:t})=>{let s=_react.useRef.call(void 0, null),{blockWidth:c}=I({windowTime:o,contentWidth:r}),{dayBlocks:d,hourBlocks:h}=q({windowTime:o,tick:e,contentWidth:r,blockWidth:c}),l=t!=null&&t.timeBar?"time-bar "+t.timeBar:"time-bar",a=t!=null&&t.dayRow?"day-row "+t.dayRow:"day-row",u=t!=null&&t.hourRow?"hour-row "+t.hourRow:"hour-row";return _react2.default.createElement("div",{className:l},_react2.default.createElement("div",{className:"empty-block"}),_react2.default.createElement("div",{className:"time-content",ref:s,style:{minWidth:r||0}},_react2.default.createElement("div",{className:a,style:{gridTemplateColumns:`repeat(auto-fill, minmax(${c}px, 1fr))`}},d.map(f=>f)),_react2.default.createElement("div",{className:u,style:{gridTemplateColumns:`repeat(auto-fill, minmax(${c}px, 1fr))`}},h.map(f=>f))),i?_react2.default.createElement("div",{style:{width:i,height:"100%",boxSizing:"border-box",borderLeft:"1px solid yellow"}}):null)},K=Te;var k=_react.createContext.call(void 0, null);var De=({name:o,id:e})=>{let r=_react.useContext.call(void 0, k),i=r&&r.rowsHeight&&r.rowsHeight[e]?r.rowsHeight[e].minHeight:40;return _react2.default.createElement("div",{className:"row-header",style:{minHeight:i}},o)},Q=De;var He=({rows:o,className:e})=>{let r=e?"rows-header-wrapper "+e:"rows-header-wrapper";return _react2.default.createElement("div",{className:r},o.map(i=>_react2.default.createElement(Q,{key:`row_header_${i.id}`,id:i.id,name:i.name})))},Z=He;var Me=({contentWidth:o,cellWidth:e,lineClassName:r})=>{let i=_react.useMemo.call(void 0, ()=>{let s=[],c=r?"line "+r:"line";if(o)for(let d=e;d<o;d=d+e)s.push(_react2.default.createElement("div",{key:`line_${d}`,className:c}));return s},[e,o]),t=_react.useMemo.call(void 0, ()=>o?o-i.length*e:0,[o,e,i]);return _react2.default.createElement("div",{className:t<1?"lines-canvas hide-last-line":"lines-canvas",style:t<1?{gridTemplateColumns:`repeat(auto-fill, minmax(${e}px, 1fr))`}:{gridTemplateColumns:`repeat(auto-fill, minmax(${t}px, ${e}px))`}},i)},oe=Me;var Ce=({id:o,startPosition:e,width:r,top:i,height:t})=>_react2.default.createElement("div",{id:`static_event_${o}`,key:`static_event_${o}`,className:"static-event",onDrop:s=>s.stopPropagation(),style:{left:e,width:r,top:i,minHeight:t}}),re=Ce;var _immer = require('immer');var B=_react.createContext.call(void 0, {dragStarted:!1,setDragStarted:()=>{}});var N=_react.createContext.call(void 0, {});var Oe=(o,e)=>o.startTime-e.startTime<0||o.startTime===e.startTime&&o.endTime<e.endTime?-1:1,j=Oe;var _e=_react.forwardRef.call(void 0, (o,e)=>{let{setEvents:r,tick:i,id:t,windowTime:s,cellWidth:c,children:d}=o,{dragStarted:h,setDragStarted:l}=_react.useContext.call(void 0, B),{onDrop:a}=_react.useContext.call(void 0, N),u=_react.useCallback.call(void 0, p=>{p.preventDefault();let g=p.target,{left:m}=g.getBoundingClientRect(),w=p.dataTransfer.getData("eventId"),x=Math.round((p.clientX-m)/c),R=c*x;r(_immer.produce.call(void 0, H=>{let n=H.find(y=>y.id===w);if(n&&i){let y=s[0]+R*i,M=n.endTime-n.startTime,T=s[0]+M+R*i;a&&a({eventId:n.id,oldRowId:n.rowId,newRowId:o.id,startTime:y,endTime:T}),n.startTime=y,n.endTime=T,n.rowId=o.id}H.sort(j)})),l(!1)},[r,i,s,c]),f=_react.useContext.call(void 0, k),b=f&&f.rowsHeight&&f.rowsHeight[t]?f.rowsHeight[t].minHeight:40;return _react2.default.createElement("div",{id:`row_${t}`,ref:e,onDragOver:p=>p.preventDefault(),onDrop:u,className:h?"row-content not-clickable":"row-content","data-index":t,style:{minHeight:b}},d)}),ne=_e;var Ie=({id:o,startPosition:e,width:r,top:i,props:t})=>{let{setDragStarted:s}=_react.useContext.call(void 0, B),c=_react.useCallback.call(void 0, l=>{l.stopPropagation(),l.dataTransfer.setData("eventId",o),setTimeout(()=>s(!0),0);let a=l.target;a.style.opacity="50%"},[s]),d=_react.useCallback.call(void 0, l=>{l.stopPropagation(),s(!1);let a=l.target;a.style.opacity="100%"},[s]),h=t!=null&&t.classNames?"event "+t.classNames.join(" "):"event";return _react2.default.createElement("div",{id:`event_${o}`,key:`event_${o}`,className:h,draggable:!(t!=null&&t.isLocked),onDragStart:c,onDragEnd:d,onMouseDown:l=>l.stopPropagation(),onMouseMove:l=>l.stopPropagation(),onDrop:l=>l.stopPropagation(),style:{left:e,width:r,top:i,cursor:t!=null&&t.isLocked?"not-allowed":"pointer"}},_react2.default.createElement("div",{className:"event-content"},t!=null&&t.content?t.content:null))},le=Ie;var Fe=({bodyRef:o,rowsContentRef:e})=>{let r=_react.useCallback.call(void 0, t=>{t.forEach(s=>{s.isIntersecting?s.target.classList.remove("row-hidden"):s.target.classList.add("row-hidden")})},[]),i=new IntersectionObserver(r,{root:o.current});_react.useEffect.call(void 0, ()=>(e.current&&e.current.forEach(t=>{i.observe(t)}),()=>i.disconnect()),[i])},ae=Fe;var Ye=({rows:o,windowTime:e,tick:r,events:i,staticEvents:t,cellWidth:s,setEvents:c,bodyRef:d})=>{let h=_react.useContext.call(void 0, k),l=_react.useRef.call(void 0, null),a=_react.useRef.call(void 0, []),[u,f]=_react.useMemo.call(void 0, ()=>{let b=0;return[o.map((p,g)=>{let m=0,w=[],x=0,R=r?i.filter(n=>n.rowId===p.id).map(n=>{if(n.endTime>=e[0]&&n.startTime<=e[1]){let y=0,M=!0;for(let T=0;T<=m;T++)if(w&&w[T]&&w[T].endTime>n.startTime)y+=1;else{m>x&&(x=m),m=0,M=!1;break}return M&&(m=y),w[y]=n,_react2.default.createElement(le,{key:`event_${n.id}`,id:n.id,startPosition:(n.startTime-e[0])/r,width:(n.endTime-n.startTime)/r,top:10+22*y,props:n.props})}}):null;m>x&&(x=m),l.current===null?l.current={[p.id]:{minHeight:40+x*22}}:l.current[p.id]={minHeight:40+x*22},b+=40+x*22;let H=r&&t?t.filter(n=>n.rowId===p.id).map(n=>{if(n.endTime>=e[0]&&n.startTime<=e[1])return _react2.default.createElement(re,{key:`static_event_${n.id}`,id:n.id,startPosition:(n.startTime-e[0])/r,width:(n.endTime-n.startTime)/r,top:10,height:20+x*22})}):null;return _react2.default.createElement(_react2.default.Fragment,{key:`row_content_${p.id}`},_react2.default.createElement(ne,{id:p.id,ref:n=>{a.current&&a.current[g]&&n?a.current[g]=n:a.current&&n&&a.current.push(n)},setEvents:c,tick:r,windowTime:e,cellWidth:s},R,H))}),b]},[o,i,r,e,s]);return ae({rowsContentRef:a,bodyRef:d}),_react.useEffect.call(void 0, ()=>{h&&(h.setRowsHeight(l.current),h.setAllRowsHeight(f))},[u,f]),u},de=Ye;var Ve=_react.forwardRef.call(void 0, ({rows:o,events:e,staticEvents:r,setEvents:i,tick:t,windowTime:s,cellWidth:c,setWindowTime:d,contentWidth:h,setCellWidth:l,bodyRef:a,lineClassName:u},f)=>{let[b,p]=_react.useState.call(void 0, !1),g=_react.useRef.call(void 0, null),[m,w]=_react.useState.call(void 0, !1),{blockWidth:x}=I({windowTime:s,contentWidth:h}),R=_react.useContext.call(void 0, k),H=_react.useCallback.call(void 0, v=>{if(v.preventDefault(),!b)return;let E=v.target,{left:L}=E.getBoundingClientRect(),S=v.clientX-L,_=t?Math.floor(t*x):0;g.current&&g.current-S>=x?(g.current=S,d(z=>[z[0]+_,z[1]+_])):g.current&&S-g.current>=x&&(g.current=S,d(z=>[z[0]-_,z[1]-_]))},[x,d,b]),n=_react.useCallback.call(void 0, v=>{p(!0),v.button===1&&v.preventDefault();let E=v.target,{left:L}=E.getBoundingClientRect();g.current=v.clientX-L},[p]),y=_react.useCallback.call(void 0, ()=>{p(!1)},[p]),M=_react.useCallback.call(void 0, ()=>p(!1),[p]),T=de({rows:o,windowTime:s,tick:t,events:e,staticEvents:r,cellWidth:c,setEvents:i,bodyRef:a}),G=_react.useCallback.call(void 0, v=>{v.preventDefault(),v.button===1&&w(E=>!E)},[]),D=_react.useCallback.call(void 0, v=>{let E=t?900/t:0;m&&l(L=>{let S=v.deltaY>0?L+E:L-E;return S<E||S>E*12?L:S})},[m,c,t]);return _react.useEffect.call(void 0, ()=>{a.current&&(a.current.style.overflow=m?"hidden":"auto")},[m]),_react2.default.createElement("div",{key:"content",ref:f,className:"content-wrapper",onMouseDown:n,onMouseUp:y,onMouseMove:H,onMouseLeave:M,onAuxClick:G,onWheel:D,style:{cursor:b?"grabbing":"grab",height:R==null?void 0:R.allRowsHeight}},_react2.default.createElement(oe,{contentWidth:h,cellWidth:c,lineClassName:u}),T)}),pe=Ve;var ot=({windowTime:o,setTick:e,setCellWidth:r,contentRef:i})=>{let t=_react.useRef.call(void 0, 0),s=_react.useMemo.call(void 0, ()=>new ResizeObserver(c=>{var d;for(let h of c){let l=(d=h.borderBoxSize)==null?void 0:d[0].inlineSize;if(typeof l=="number"&&l!==t.current){t.current=l;let a=o[1]-o[0],u=a/3600;e(a/h.contentRect.width),r(h.contentRect.width/u)}}}),[o]);_react.useEffect.call(void 0, ()=>(i.current&&s.observe(i.current,{box:"border-box"}),()=>s.disconnect()),[s])},he=ot;var Lo=({rows:o,events:e,staticEvents:r,onDrop:i,startDate:t,endDate:s,additionalClassNames:c})=>{let[d,h]=_react.useState.call(void 0, [new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),0,0).getTime()/1e3,new Date(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),0,0).getTime()/1e3]),[l,a]=_react.useState.call(void 0, 0),[u,f]=_react.useState.call(void 0, []),b=_react.useRef.call(void 0, null),p=_react.useRef.call(void 0, null),g=_react.useRef.call(void 0, null),[m,w]=_react.useState.call(void 0, null),[x,R]=_react.useState.call(void 0, 0),[H,n]=_react.useState.call(void 0, null),[y,M]=_react.useState.call(void 0, 0);_react.useEffect.call(void 0, ()=>{if(b.current){let D=d[1]-d[0],v=D/3600;w(D/b.current.getBoundingClientRect().width),a(b.current.getBoundingClientRect().width/v)}},[]),_react.useEffect.call(void 0, ()=>{g.current&&R(g.current.getBoundingClientRect().width-g.current.scrollWidth)},[]),_react.useEffect.call(void 0, ()=>{f(e.sort(j))},[e]);let[T,G]=_react.useState.call(void 0, !1);return _react.useEffect.call(void 0, ()=>{let D=null;o.forEach(v=>{D===null?D={[v.id]:{minHeight:40}}:D[v.id]={minHeight:40}}),n(D)},[o]),he({contentRef:b,setCellWidth:a,setTick:w,windowTime:d}),_react2.default.createElement("div",{className:"main-wrapper",ref:p},_react2.default.createElement(K,{windowTime:d,tick:m,contentWidth:b.current?b.current.getBoundingClientRect().width:null,scrollWidth:x}),_react2.default.createElement("div",{className:"body-wrapper",ref:g},_react2.default.createElement(k.Provider,{value:{rowsHeight:H,setRowsHeight:n,allRowsHeight:y,setAllRowsHeight:M}},_react2.default.createElement(Z,{rows:o,className:c==null?void 0:c.rowsHeader}),_react2.default.createElement(B.Provider,{value:{dragStarted:T,setDragStarted:G}},_react2.default.createElement(N.Provider,{value:{onDrop:i}},_react2.default.createElement(pe,{events:u,staticEvents:r,rows:o,setEvents:f,tick:m,windowTime:d,cellWidth:l,setWindowTime:h,ref:b,setCellWidth:a,contentWidth:b.current?b.current.getBoundingClientRect().width:null,bodyRef:g,lineClassName:c==null?void 0:c.gridLine}))))))};exports.Timeline = Lo;
//# sourceMappingURL=index.js.map