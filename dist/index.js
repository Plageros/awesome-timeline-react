"use strict"; function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }var _react = require('react'); var _react2 = _interopRequireDefault(_react);var ee=({windowTime:o,contentWidth:t})=>{let n=_react.useMemo.call(void 0, ()=>(o[1]-o[0])/3600,[o]),i=t?t/n:0;return{numberOfHourBlocks:n,blockWidth:i}},$=ee;var k=_react.createContext.call(void 0, null);var oe=({contentWidth:o,cellWidth:t,lineClassName:n})=>{let i=_react.useMemo.call(void 0, ()=>{let s=[],p=n?"line "+n:"line";if(o)for(let m=t;m<o;m=m+t)s.push(_react2.default.createElement("div",{key:`line_${m}`,className:p}));return s},[t,o]),e=_react.useMemo.call(void 0, ()=>o?o-i.length*t:0,[o,t,i]);return _react2.default.createElement("div",{className:e<1?"lines-canvas hide-last-line":"lines-canvas",style:e<1?{gridTemplateColumns:`repeat(auto-fill, minmax(${t}px, 1fr))`}:{gridTemplateColumns:`repeat(auto-fill, minmax(${e}px, ${t}px))`}},i)},N=oe;var ne=({id:o,startPosition:t,width:n,top:i,height:e})=>_react2.default.createElement("div",{id:`static_event_${o}`,key:`static_event_${o}`,className:"static-event",onDrop:s=>s.stopPropagation(),style:{left:t,width:n,top:i,minHeight:e}}),j=ne;var _immer = require('immer');var P=_react.createContext.call(void 0, {dragStarted:!1,setDragStarted:()=>{}});var z=_react.createContext.call(void 0, {});var le=(o,t)=>o.startTime-t.startTime<0||o.startTime===t.startTime&&o.endTime<t.endTime?-1:1,W=le;var me=_react.forwardRef.call(void 0, (o,t)=>{let{setEvents:n,tick:i,id:e,windowTime:s,cellWidth:p,children:m}=o,{dragStarted:w,setDragStarted:l}=_react.useContext.call(void 0, P),{onDrop:a}=_react.useContext.call(void 0, z),M=_react.useCallback.call(void 0, d=>{d.preventDefault();let c=d.target,{left:b}=c.getBoundingClientRect(),f=d.dataTransfer.getData("eventId"),T=Math.round((d.clientX-b)/p),R=p*T;n(_immer.produce.call(void 0, r=>{let u=r.find(y=>y.id===f);if(u&&i){let y=s[0]+R*i,E=u.endTime-u.startTime,O=s[0]+E+R*i;a&&a({eventId:u.id,oldRowId:u.rowId,newRowId:o.id,startTime:y,endTime:O}),u.startTime=y,u.endTime=O,u.rowId=o.id}r.sort(W)})),l(!1)},[n,i,s,p]),x=_react.useContext.call(void 0, k),g=x&&x.rowsHeight&&x.rowsHeight[e]?x.rowsHeight[e].minHeight:40;return _react2.default.createElement("div",{id:`row_${e}`,ref:t,onDragOver:d=>d.preventDefault(),onDrop:M,className:w?"row-content not-clickable":"row-content","data-index":e,style:{minHeight:g}},m)}),F=me;var he=({id:o,startPosition:t,width:n,top:i,props:e})=>{let{setDragStarted:s}=_react.useContext.call(void 0, P),p=_react.useCallback.call(void 0, l=>{l.stopPropagation(),l.dataTransfer.setData("eventId",o),setTimeout(()=>s(!0),0);let a=l.target;a.style.opacity="50%"},[s]),m=_react.useCallback.call(void 0, l=>{l.stopPropagation(),s(!1);let a=l.target;a.style.opacity="100%"},[s]),w=e!=null&&e.classNames?"event "+e.classNames.join(" "):"event";return _react2.default.createElement("div",{id:`event_${o}`,key:`event_${o}`,className:w,draggable:!(e!=null&&e.isLocked),onDragStart:p,onDragEnd:m,onMouseDown:l=>l.stopPropagation(),onMouseMove:l=>l.stopPropagation(),onDrop:l=>l.stopPropagation(),style:{left:t,width:n,top:i,cursor:e!=null&&e.isLocked?"not-allowed":"pointer"}},_react2.default.createElement("div",{className:"event-content"},e!=null&&e.content?e.content:null))},X=he;var be=({bodyRef:o,rowsContentRef:t})=>{let n=_react.useCallback.call(void 0, e=>{e.forEach(s=>{s.isIntersecting?s.target.classList.remove("row-hidden"):s.target.classList.add("row-hidden")})},[]),i=new IntersectionObserver(n,{root:o.current});_react.useEffect.call(void 0, ()=>(t.current&&t.current.forEach(e=>{i.observe(e)}),()=>i.disconnect()),[i])},Y=be;var Te=({rows:o,windowTime:t,tick:n,events:i,staticEvents:e,cellWidth:s,setEvents:p,bodyRef:m})=>{let w=_react.useContext.call(void 0, k),l=null,a=_react.useRef.call(void 0, []),M=0,x=_react.useMemo.call(void 0, ()=>o.map((g,d)=>{let c=0,b=[],f=0,T=n?i.filter(r=>r.rowId===g.id).map(r=>{if(r.endTime>=t[0]&&r.startTime<=t[1]){let u=0,y=!0;for(let E=0;E<=c;E++)if(b&&b[E]&&b[E].endTime>r.startTime)u+=1;else{c>f&&(f=c),c=0,y=!1;break}return y&&(c=u),b[u]=r,_react2.default.createElement(X,{key:`event_${r.id}`,id:r.id,startPosition:(r.startTime-t[0])/n,width:(r.endTime-r.startTime)/n,top:10+22*u,props:r.props})}}):null;c>f&&(f=c),l===null?l={[g.id]:{minHeight:40+f*22}}:l[g.id]={minHeight:40+f*22},M+=40+f*22;let R=n&&e?e.filter(r=>r.rowId===g.id).map(r=>{if(r.endTime>=t[0]&&r.startTime<=t[1])return _react2.default.createElement(j,{key:`static_event_${r.id}`,id:r.id,startPosition:(r.startTime-t[0])/n,width:(r.endTime-r.startTime)/n,top:10,height:20+f*22})}):null;return _react2.default.createElement(_react2.default.Fragment,{key:`row_content_${g.id}`},_react2.default.createElement(F,{id:g.id,ref:r=>{a.current&&a.current[d]&&r?a.current[d]=r:a.current&&r&&a.current.push(r)},setEvents:p,tick:n,windowTime:t,cellWidth:s},T,R))}),[o,i,n,t,s]);return Y({rowsContentRef:a,bodyRef:m}),_react.useEffect.call(void 0, ()=>{w&&(w.setRowsHeight(l),w.setAllRowsHeight(M))},[x]),x},U=Te;var Zt=_react.forwardRef.call(void 0, ({rows:o,events:t,staticEvents:n,setEvents:i,tick:e,windowTime:s,cellWidth:p,setWindowTime:m,contentWidth:w,setCellWidth:l,bodyRef:a,lineClassName:M},x)=>{let[g,d]=_react.useState.call(void 0, !1),c=_react.useRef.call(void 0, null),[b,f]=_react.useState.call(void 0, !1),{blockWidth:T}=$({windowTime:s,contentWidth:w}),R=_react.useContext.call(void 0, k),r=_react.useCallback.call(void 0, h=>{if(h.preventDefault(),!g)return;let v=h.target,{left:H}=v.getBoundingClientRect(),D=h.clientX-H,B=e?Math.floor(e*T):0;c.current&&c.current-D>=T?(c.current=D,m(C=>[C[0]+B,C[1]+B])):c.current&&D-c.current>=T&&(c.current=D,m(C=>[C[0]-B,C[1]-B]))},[T,m,g]),u=_react.useCallback.call(void 0, h=>{d(!0),h.button===1&&h.preventDefault();let v=h.target,{left:H}=v.getBoundingClientRect();c.current=h.clientX-H},[d]),y=_react.useCallback.call(void 0, ()=>{d(!1)},[d]),E=_react.useCallback.call(void 0, ()=>d(!1),[d]),O=U({rows:o,windowTime:s,tick:e,events:t,staticEvents:n,cellWidth:p,setEvents:i,bodyRef:a}),Q=_react.useCallback.call(void 0, h=>{h.preventDefault(),h.button===1&&f(v=>!v)},[]),V=_react.useCallback.call(void 0, h=>{let v=e?900/e:0;b&&l(H=>{let D=h.deltaY>0?H+v:H-v;return D<v||D>v*12?H:D})},[b,p,e]);return _react.useEffect.call(void 0, ()=>{a.current&&(a.current.style.overflow=b?"hidden":"auto")},[b]),_react2.default.createElement("div",{key:"content",ref:x,className:"content-wrapper",onMouseDown:u,onMouseUp:y,onMouseMove:r,onMouseLeave:E,onAuxClick:Q,onWheel:V,style:{cursor:g?"grabbing":"grab",height:R==null?void 0:R.allRowsHeight}},_react2.default.createElement(N,{contentWidth:w,cellWidth:p,lineClassName:M}),O)});
//# sourceMappingURL=index.js.map